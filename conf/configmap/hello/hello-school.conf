module_conf: [
  {
    name: "KafkaConsumerModule"
    conf: {
      work_thread_num: 1
      enabled: true
      queue_size: 256
      kafka_consumer: {
        brokers: "kafka-common-conn1.bigdata-out.bigo.inner:9092,kafka-common-conn2.bigdata-out.bigo.inner:9092,kafka-common-conn3.bigdata-out.bigo.inner:9092"
        groupid: ["hellofire-ml-audit_pic_hello_school"]
        topic: ["hellofire-ml-audit_pic_hello_school"]
      }
    }
  },
  {
    name: "DownloaderModule"
    conf: {
      work_thread_num: 128
      queue_size: 256
      enabled: true
      downloader: {
        timeout_ms: 15000
        max_retry: 1
        lb: "rr"
        enable_image: true
        enable_video: false
        enable_voice: false
      }
    }
  },
  {
    name: "MultiImageDispatcherModule"
    conf: {
      work_thread_num: 16
      enabled: true
      dispatcher: {
        batch_size: 1
        block_queue_timeout_ms: 2000
        submodule_conf : [
          {
            name: "FeatureMatchSubModule"
            conf: {
              rpc: {
                url: "http://helloschool-photo-sim-audit.ann/api/helloschool-photo-sim-audit"
                lb: "la"
                max_retry: 3
                timeout_ms: 5000
              },
              feature_match: {
                query_rpc: {
                  url: "https://hk-ml-api.bigo.sg/feature_match/feature/callback_no_report"
                  lb: "rr"
                  max_retry: 1
                  timeout_ms: 3000

                }
                storename: "helloschool-photo-sim-audit"
              }
            }
          },
          {
            name: "FaceMatchSubModule"
            conf: {
              rpc: {
                url: "http://helloschool-photo-face-audit.ann/api/helloschool-photo-face-audit"
                lb: "rr"
                max_retry: 3
                timeout_ms: 5000
              }
              feature_match: {
                query_rpc: {
                  url: "https://hk-ml-api.bigo.sg/feature_match/feature/callback_no_report"
                  lb: "rr"
                  max_retry: 1
                  timeout_ms: 3000
                }
                storename: "helloschool-photo-face-audit"
              }
            }
          },

          {
            name: "ImageOcrSubModule"
            conf: {
              rpc: {
                url: "http://ocr-audit.bigolive/api/ocr-audit"
                lb: "la"
                max_retry: 1
                timeout_ms: 3000
              }
              image_ocr: {
                rpc: {
                  url: "http://helloschool-word-audit.nlp.svc.cluster.local/api/helloschool-word-audit"
                  lb: "rr"
                  timeout_ms: 3000
                  max_retry: 1
                }
                appid: "93"
                businessid: 22
                text_type: 1
                result_key: "ocr-audit"
              }
            }
          },

          {
            name: "ImageCoreSubModule"
            conf: {
              rpc: {
                url: "http://hello-pic-v05.hello.svc.cluster.local/api/hello-pic-v05"
                lb: "rr"
                max_retry: 3
                timeout_ms: 5000
              }
              enable_model: ["porn"]
              thresholds: [
                {
                  country: ["default"]
                  model: "porn"
                  threshold: -1
                }
              ]
            }
          },
          {
            name: "BasicSubModule"
            conf: {
              instance_name: "HelloAvatarCompSubModule"
              rpc: {
                url: "http://cv-hello-multiclass-image-service.common:8000/api/cv-hello-multiclass-image-service"
                lb: "rr"
                max_retry: 3
                timeout_ms: 3000
              }
              thresholds: [
                {
                  country: ["default"]
                  model: "body_exposure"
                  threshold: -1
                },
                {
                  country: ["default"]
                  model: "anime_female"
                  threshold: -1
                },
                {
                  country: ["default"]
                  model: "knife_and_gun"
                  threshold: -1
                },
                {
                  country: ["default"]
                  model: "scar"
                  threshold: -1
                },
                {
                  country: ["default"]
                  model: "flag_and_badge"
                  threshold: -1
                },
                {
                  country: ["default"]
                  model: "politic_dressing"
                  threshold: -1
                },
                {
                  country: ["default"]
                  model: "winnie_bear"
                  threshold: -1
                },
                {
                  country: ["default"]
                  model: "SM"
                  threshold: -1
                }
              ]
              basic: {
                class_num: 8
                model_types: "efficientnet"
                model_keys: "body_exposure,anime_female,knife_and_gun,scar,flag_and_badge,politic_dressing,winnie_bear,SM"
                appid: "pic-hello-avatar-comp-cls8"
                normal_label_index: -1
              }
            }
          }
          # {
          #   name: "ImageWatermarkSubModule"
          #   conf: {
          #     rpc: {
          #       url: "http://hello-img-watermark-audit.ann:80/api/hello-img-watermark-audit"
          #       lb: "rr"
          #       max_retry: 1
          #       timeout_ms: 5000
          #     },
          #     enable_model: ["watermark"]
          #   }
          # }
        ]
      }
    }
  },
  {
    name: "ReviewModule"
    conf: {
      enabled: true
      work_thread_num: 128
      review: {
        timeout_ms: 2000
        lb: "rr"
        max_retry: 3
      }
    }
  },
  {
    name: "UploadHiveModule"
    conf: {
      enabled: true
      work_thread_num: 128
      upload_hive: {
        timeout_ms: 1500
        lb: "rr"
        max_retry: 1

        url: "http://support_json.like.video/json?uri=123213423&aid=60"
      }
    }
  },
  {
    name: "EndModule"
    conf: {
      enabled: true
      work_thread_num: 1
    }
  }
]
