module_conf: [
  {
    name: "LikeKafkaConsumerModule"
    conf: {
      work_thread_num: 1
      queue_size: 1
      enabled: true
      kafka_consumer: {
        brokers: "kafka-likee-conn1.bigdata-out.bigo.inner:9092,kafka-likee-conn2.bigdata-out.bigo.inner:9092,kafka-likee-conn3.bigdata-out.bigo.inner:9092"
        topic: ["likee-ml-video_as_audit", "likee-ml-video_na_audit", "likee-ml-video_eu_audit"]
        groupid: ["ml_like_video_scan"]
        callback_url: "http://zhixu-api-sg.zhixu.bigo.inner/justice-video-prod/machine-result-v2"
        rollback_offset: 128
      }
    }
  },
  {
    name: "SortModule"
    conf: {
      work_thread_num: 1
      queue_size: 1
      enabled: true
      sort: { 
        sort_buffer_size: 54000
        delay_ms: 120000
        # delay_ms: 180000
      }
    } 
  },
  {
    name: "DuplicatedModule"
    conf: {
      instance_name: "DuplicateQueryModule"
      work_thread_num: 128
      queue_size: 1
      enabled: true
      duplicated: {
        timeout_ms: 2000
        password_index: 2
        hosts: "list://103.211.228.3:12600,103.211.228.4:12600,103.211.228.5:12600,103.211.228.6:12600"
        prefix: "like_kafka_"
        expire_second: 604800 # 7 Day
        op: "query"
      }
    } 
  },
  {
    name: "DownloaderModule"
    conf: {
      work_thread_num: 128
      queue_size: 1
      enabled: true
      downloader: {
        timeout_ms: 30000
        max_retry: 2
        lb: "la"
        enable_image: true
        enable_video: true
        enable_voice: false
      }
    }
  },
  {
    name: "DecodeClusterDownloaderModule"
    conf: {
      work_thread_num: 128
      queue_size: 1
      enabled: true
      downloader: {
        timeout_ms: 30000
        max_retry: 2
        lb: "la"
      }
    }
  },
  {
    name: "DispatcherModule"
    conf: {
      work_thread_num: 64
      queue_size: 1
      enabled: true
      dispatcher: {
        batch_size: 1
        submodule_conf : [
          #-------------------------------- Cover Module
          {
            name: "LikeCoverSubModule"
            conf: {
              instance_name: "BlackScreenSubModule"
              rpc: {
                url: "http://blackscreen.like/api/blackscreen"
                lb: "la"
                max_retry: 2
                timeout_ms: 5000
              }
              thresholds:[
                {
                  model: "black_screen"
                  country: ["default"]
                  threshold:  -2268
                }
              ]
            }
          },
          {
            name: "LikeCoverSubModule"
            conf: {
              instance_name: "CoverSubModule"
              rpc: {
                url: "http://cover.like/api/cover"
                lb: "la"
                max_retry: 2
                timeout_ms: 5000
              }
              thresholds:[
                {
                  model: "cover_Comp"
                  country: ["default"]
                  threshold: 0.902615
                }
              ]
            }
          },

          #------------------------------- LikeSafeAuditSubModule
          {
            name: "LikeSafeAuditSubModule"
            conf: {
              instance_name: "DiscomfortSubModule"
              response_version: "TaggingServiceResponse"
              rpc: {
                url: "http://cv-horror-accident-v2-flask-deploy.like/api/cv-horror-accident-v2-flask-deploy"
                lb: "la"
                max_retry: 2
                timeout_ms: 5000
              }
              enable_model: ["horror", "accident"]
              effect_list: [
                {
                  effect_name: "sticker"
                  model_name: "horror"
                  ids: [98, 3164, 1342, 1414, 1243, 3171, 3179, 1237, 1419, 27, 118, 1463, 1237, 1432, 1158, 1524, 1404],
                },
                {
                  effect_name: "cut_me_id"
                  model_name: "horror"
                  ids: [959],
                },
                {
                  effect_name: "cutme_id"
                  model_name: "horror"
                  ids: [959]
                },
                {
                  effect_name: "body_magic"
                  model_name: "horror"
                  ids: [38]
                },
                {
                  effect_name: "magic"
                  model_name: "accident"
                  ids: [1004, 1011, 10081, 100286, 1068, 100285, 1012, 1028]
                },
                {
                  effect_name: "sticker"
                  model_name: "accident"
                  ids: [3343, 2754, 1419, 1237, 98, 1432, 1243, 1158, 1524, 1414, 1404, 1463],
                },
                {
                  effect_name: "cut_me_id"
                  model_name: "accident"
                  ids: [188, 368, 369, 459, 1224, 1526]
                },
                {
                  effect_name: "cutme_id"
                  model_name: "accident"
                  ids: [188, 368, 369, 459, 1224, 1526]
                },
                {
                  effect_name: "music_magic"
                  model_name: "accident"
                  ids: [6, 7]
                },
                {
                  effect_name: "boom"
                  model_name: "accident"
                  ids: [19, 16, 14, 22, 12, 13, 17]
                }
              ] 
            }
          },
          {
            name: "LikeSafeAuditSubModule"
            conf: {
              instance_name: "SoftpornMultiSubModule"
              response_version: "TaggingServiceResponse"
              rpc: {
                url: "http://cv-softporn-global-flask-deploy.like/api/cv-softporn-global-flask-deploy"
                lb: "la"
                max_retry: 2
                timeout_ms: 5000
              }
              enable_model: ["nudity_male", "nudity_female", "inappropriate_sitting_female", "genital_shape_female", "inappropriate_dressing_female"]
            }
          }, 
          {
            name: "LikeSafeAuditSubModule"
            conf: {
              instance_name: "DrugSubModule"
              response_version: "TaggingServiceResponse"
              rpc: {
                url: "http://cv-drug-cascade-v2-flask-deploy.like/api/cv-drug-cascade-v2-flask-deploy"
                lb: "la"
                max_retry: 2
                timeout_ms: 5000
              }
              enable_model: ["drug"]
            }
          }, 
          {
            name: "LikeSafeAuditSubModule"
            conf: {
              instance_name: "PoliticsSubModule"
              response_version: "TaggingServiceResponse"
              rpc: {
                url: "http://cv-politics-flask-deploy.like/api/cv-politics-flask-deploy"
                lb: "la"
                max_retry: 2
                timeout_ms: 5000
              }
              enable_model: ["leader_political_metaphor", "reactionary", "religious_violations"]
              effect_list: [
                {
                  effect_name: "magic"
                  model_name: "leader_political_metaphor"
                  ids: [1043]
                }
              ]
            }
          }, 
          {
            name: "LikeSafeAuditSubModule"
            conf: {
              instance_name: "GambleSubModule"
              response_version: "TaggingServiceResponse"
              rpc: {
                url: "http://cv-gamble-flask-deploy.like/api/cv-gamble-flask-deploy"
                lb: "la"
                max_retry: 2
                timeout_ms: 5000
              }
              enable_model: ["gamble"]
              effect_list: [
                {
                  effect_name: "cut_me_id"
                  model_name: "gamble"
                  ids: [1691]
                },
                {
                  effect_name: "cutme_id"
                  model_name: "gamble"
                  ids: [1691]
                }
              ]
            }
          }, 
          {
            name: "LikeSafeAuditSubModule"
            conf: {
              instance_name: "SuicideFuneralSubModule"
              response_version: "TaggingServiceResponse"
              rpc: {
                url: "http://cv-suicide-funeral-v2-flask-deploy.like/api/cv-suicide-funeral-v2-flask-deploy"
                lb: "la"
                max_retry: 2
                timeout_ms: 5000
              }
              enable_model: ["suicide", "funeral"]
            }
          },
          {
            name: "LikeSafeAuditSubModule"
            conf: {
              instance_name: "KnifeSubModule"
              response_version: "FineGrainedModelResponse"
              rpc: {
                url: "http://cv-knife-flask-deploy.like/api/cv-knife-flask-deploy"
                lb: "la"
                max_retry: 2
                timeout_ms: 5000
              }
              enable_model: ["knife"]
            }
          }, 
          {
            name: "LikeSafeAuditSubModule"
            conf: {
              instance_name: "PornActionSubModule"
              response_version: "FineGrainedModelResponse"
              rpc: {
                url: "http://cv-action-porn-flask-deploy.like/api/cv-action-porn-flask-deploy"
                lb: "la"
                max_retry: 2
                timeout_ms: 5000
              }
              enable_model: ["porn_action"]
            }
          },
          {
            name: "LikeSafeAuditSubModule"
            conf: {
              instance_name: "GunSubModule"
              response_version: "FineGrainedModelResponse"
              rpc: {
                url: "http://cv-gun-scene-duet-v2-flask-deploy.like/api/cv-gun-scene-duet-v2-flask-deploy"
                lb: "la"
                max_retry: 2
                timeout_ms: 5000
              }
              enable_model: ["gun"]
            }
          },
          {
            name: "LikeSafeAuditSubModule"
            conf: {
              instance_name: "SoftPornGlobalSubModule"
              response_version: "FineGrainedModelResponse"
              rpc: {
                url: "http://softporn-global.like/api/softporn-global"
                lb: "la"
                max_retry: 2
                timeout_ms: 5000
              }
              enable_model: ["softporn_global"]
            }
          },  

          {
            name: "LikeSafeAuditSubModule"
            conf: {
              instance_name: "StaticPornSubModule"
              response_version: "FineGrainedModelResponse"
              rpc: {
                url: "http://static-porn.like/api/static-porn"
                lb: "la"
                max_retry: 2
                timeout_ms: 5000
              }
              enable_model: ["static_porn"]
            }
          },  

          {
            name: "LikeSafeAuditSubModule"
            conf: {
              instance_name: "ViolenceActionSubModule"
              response_version: "FineGrainedModelResponse"
              rpc: {
                url: "http://violence-action.like/api/violence-action"
                lb: "la"
                max_retry: 2
                timeout_ms: 5000
              }
              enable_model: ["violence_action"]
              effect_list: [
                {
                  effect_name: "sticker"
                  model_name: "violence_action"
                  ids: [1419, 1432, 1243]
                }
              ]
            }
          },  
         
          {
            name: "LikeSafeAuditSubModule"
            conf: {
              instance_name: "ChildPornSubModule"
              response_version: "FineGrainedModelResponse"
              rpc: {
                url: "http://child-porn.like/api/child-porn"
                lb: "la"
                max_retry: 2
                timeout_ms: 5000
              }
              enable_model: ["child_porn"]
            }
          },  
          {
            name: "LikeSafeAuditSubModule"
            conf: {
              instance_name: "HeavePornSubModule"
              response_version: "TaggingServiceResponse"
              rpc: {
                url: "http://cv-heavy-porn-flask-deploy.like/api/cv-heavy-porn-flask-deploy"
                lb: "la"
                max_retry: 2
                timeout_ms: 5000
              }
              enable_model: ["heavy_porn"]
            }
          },  
          {
            name: "LikeSafeAuditSubModule"
            conf: {
              instance_name: "KissSubModule"
              response_version: "FineGrainedModelResponse"
              rpc: {
                url: "http://kiss.like/api/kiss"
                lb: "la"
                max_retry: 2
                timeout_ms: 5000
              }
              enable_model: ["kiss"]
            }
          },  


          {
            name: "LikeSafeAuditSubModule"
            conf: {
              instance_name: "CigaretteSubModule"
              response_version: "FineGrainedModelResponse"
              rpc: {
                url: "http://cigarette.like/api/cigarette"
                lb: "la"
                max_retry: 2
                timeout_ms: 5000
              }
              enable_model: ["cigarette"]
            }
          }, 

          {
            name: "LikeSafeAuditSubModule"
            conf: {
              instance_name: "BloodSubModule"
              response_version: "FineGrainedModelResponse"
              rpc: {
                url: "http://cv-blood-new-flask-deploy.like/api/cv-blood-new-flask-deploy"
                lb: "la"
                max_retry: 2
                timeout_ms: 5000
              }
              enable_model: ["blood"]
              effect_list: [
                {
                  effect_name: "sticker"
                  model_name: "blood"
                  ids: [1419, 27, 98, 1432, 1243, 2263, 13, 1414, 2188, 1404]
                }
              ]
            }
          }, 

          {
            name: "LikeSafeAuditSubModule"
            conf: {
              instance_name: "TerrorFlagSubModule"
              response_version: "FineGrainedModelResponse"
              rpc: {
                url: "http://cv-terror-flag-flask-deploy.like/api/cv-terror-flag-flask-deploy"
                lb: "la"
                max_retry: 2
                timeout_ms: 5000
              }
              enable_model: ["terror_flag"]
              effect_list: [
                {
                  effect_name: "cut_me_id"
                  model_name: "terror_flag"
                  ids: [1571, 1572],
                },
                {
                  effect_name: "cutme_id"
                  model_name: "terror_flag"
                  ids: [1199]
                }
              ]
            }
          }, 

          

          {
            name: "LikeOcrSubModule"
            conf: {
              rpc: {
                url: "http://infer-hk.ingress.bigoml.cc:8080/api/like/likeocr"
                lb: "la"
                max_retry: 0
                timeout_ms: 5000
              }
              image_ocr: {
                rpc: {
                  url: "http://infer-sg.ingress.bigoml.cc:8080/api/like/word-audit"
                  lb: "rr"
                  timeout_ms: 3000
                  max_retry: 1
                }
              }
            } 
          },
          {
            name: "LikePornSubModule"
            conf: {
              rpc: {
                url: "http://like-core-porn-softporn.like/api/like-core-porn-softporn"
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }
              thresholds: [
                {
                  country: ["default"]
                  model: "porn"
                  threshold: 0.723
                },
                {
                  country: ["AE", "BH", "KW", "OM", "QA", "SA"]
                  model: "porn"
                  threshold: 0.31
                },
                {
                  country: ["BR", "PT", "RU", "UA", "BY", "KZ", "TJ", "KG", "UZ", "TM", "AM", "GE", "AZ", "LV", "LT", "EE", "DE", "AT", "LI", "BE", "CH", "IS", "NL", "CZ", "SK", "PL", "RO", "HR", "GR", "NO", "FI", "DK", "SE", "HU", "LU", "BA", "BG", "RS", "MK", "AL", "ME", "SI", "MD", "FR", "MC", "HT", "IT", "SM", "VA", "GB", "NZ", "AU", "IE", "PR", "MT"]
                  model: "porn"
                  threshold: 0.6
                },
                {
                  country: ["IN"]
                  model: "softporn"
                  threshold: 0.937
                }
              ]
            } 
          },

          # --------------------- Feature Module
          {
            name: "LikeWatermarkSubModule"
            conf: {
              rpc: {
                url: "http://like-watermark-audit.ann/api/like-watermark-audit"
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }
            } 
          },
          {
            name: "LikeGeneralFeatureModule"
            conf: {
              rpc: {
                url: "http://vbr-cnn-general-service.ann/api/vbr-cnn-general-service"
                lb: "la"
                max_retry: 1
                timeout_ms: 5000
              }
              extra_data: [
                {
                  key: "ann_url"
                  val: "http://infer-jja.ingress.bigoml.cc:8080/api/ann/dup-sim-audit-uranus"
                },
                {
                  key: "kakashi_url"
                  val: "http://infer-sg.ingress.bigoml.cc:8080/api/ann/all-kakashi"
                },
                {
                  key: "lowq_url"
                  val: "http://infer-sg.ingress.bigoml.cc:8080/api/vbr-likee-low-quality-service"
                },
                {
                  key: "ann_blacklist_url"
                  val: "http://infer-sg.ingress.bigoml.cc:8080/api/like-sim-audit-blacklist"
                }
              ]
            } 
          },
          {
            name: "LikeFaceAuditImageModule"
            conf: {
              instance_name: "LikeFaceAuditImageModule"
              rpc: {
                url: "http://likee-img-face-audit.ann:8000/api/likee-img-face-audit"
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }
            } 
          },
          {
            name: "LikeBlackListSubModule"
            conf: {
              instance_name: "LikeBlackListSubModule"
              rpc: {
                url: "http://infer-jja.ingress.bigoml.cc:8080/api/ann/dup-sim-audit-uranus"
                lb: "la"
                max_retry: 2
                timeout_ms: 5000
              }
            }
          },
          # -------------------- Quality Module
          {
            name: "LikeLowQualityExposureSubModule"
            conf: {
              instance_name: "LikeLowQualityExposureSubModule"
              enable_model: ["like-exposure-audit"]
              rpc: {
                url: "http://like-exposure-audit.ann/api/like-exposure-audit"
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }
              extra_data: {
                key: "enable_cover"
                val: "1"
              }
            } 
          },
          {
            name: "LikeLowQualityExposureSubModule"
            conf: {
              instance_name: "LikeLowQualityBlankEdgeSubModule"
              enable_model: ["like-blank-edge-audit"]
              rpc: {
                url: "http://like-blank-edge-audit.ann/api/like-blank-edge-audit"
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }
              extra_data: {
                key: "enable_cover"
                val: "0"
              }
            } 
          },
          # {
          #   name: "LikeLowQualityAgeSubModule"
          #   conf: {
          #     instance_name: "LikeLowQualityAgeSubModule"
          #     enable_model: ["child_alone"]
          #     rpc: {
          #       url: "http://likee-vlog-minors-audit.ann/api/likee-vlog-minors-audit"
          #       lb: "la"
          #       max_retry: 1
          #       timeout_ms: 10000
          #     }
          #   } 
          # },
          {
            name: "LikeLowQualityGeneralSubModule"
            conf: {
              instance_name: "LikeLowQualityGeneralSubModule"
              rpc: {url: ""}
            } 
          },
          #----------------------- Audio
          {
            name: "LikeAudioSimSubModule"
            conf: {
              instance_name: "LikeAudioSimSubModule"
              rpc: {
                url: "http://infer-eu.ingress.bigoml.cc:8080/api/like/likee-audio-audit"
                lb: "la"
                max_retry: 2
                timeout_ms: 5000
              }
              enable_country: ["RU"]
            }
          }

        ]
      }
    }
  },
  {
    name: "DispatcherModule"
    conf: {
      instance_name: "SecondaryDispatcherModule"
      work_thread_num: 64
      queue_size: 1
      enabled: true
      dispatcher: {
        batch_size: 1
        submodule_conf : [
          {
            name: "LikeLowQualityOcrBasedSubModule"
            conf: {
              instance_name: "LikeLowQualityOcrBasedSubModule"
              rpc: {
                url: "http://infer-sg.ingress.bigoml.cc:8080/api/ann/likee-vlog-ocrbased-lowquality"
                lb: "la"
                max_retry: 2
                timeout_ms: 5000
              }
              extra_data: [
                {
                  key: "base_op"
                  val: "all"
                }
              ]
            }
          }
        ]
      }
    }
  },
  {
    name: "DispatcherModule"
    conf: {
      instance_name: "WhiteListModule"
      work_thread_num: 64
      queue_size: 1
      enabled: true
      dispatcher: {
        batch_size: 1
        submodule_conf : [
          {
            name: "LikeWhiteListSubModule"
            conf: {
              instance_name: "LikeWhiteListSubModule"
              rpc: {
                url: "http://infer-jja.ingress.bigoml.cc:8080/api/ann/sim-audit-whitelist"
                lb: "la"
                max_retry: 2
                timeout_ms: 5000
              }
            }
          }
        ]
      }
    }
  },
  {
    name: "LikeReviewModule"
    conf: {
      enabled: true
      work_thread_num: 128
      review: {
        timeout_ms: 2000
        lb: "la"
        max_retry: 3
        appid: "4801"
      }
    }
  },
  {
    name: "UploadHiveModule"
    conf: {
      enabled: true
      work_thread_num: 128
      upload_hive: {
        timeout_ms: 1500
        lb: "rr"
        max_retry: 1
        url: "http://support_json.like.video/json?uri=123213425&aid=60"
        rewrite_business_type: "like_video_push_scan"
      }
    }
  },
  {
    name: "DuplicatedModule"
    conf: {
      instance_name: "DuplicateWriteModule"
      work_thread_num: 128
      queue_size: 1
      enabled: true
      duplicated: {
        timeout_ms: 2000
        password_index: 2
        hosts: "list://103.211.228.3:12600,103.211.228.4:12600,103.211.228.5:12600,103.211.228.6:12600"
        prefix: "like_kafka_"
        expire_second: 604800 # 7 Day
        op: "query"
      }
    } 
  },
  {
    name: "EndModule"
    conf: {
      enabled: true
      work_thread_num: 12
    }
  }
]