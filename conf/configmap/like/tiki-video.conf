module_conf: [
  {
    name: "LikeKafkaConsumerModule"
    conf: {
      work_thread_num: 1
      queue_size: 64
      enabled: true
      kafka_consumer: {
        brokers: "kafka-likee-conn1.bigdata-out.bigo.inner:9092,kafka-likee-conn2.bigdata-out.bigo.inner:9092,kafka-likee-conn3.bigdata-out.bigo.inner:9092"
        topic: ["likee-ml-tiki_video_audit"]
        groupid: ["likee_ml_tiki_video_audit"]
        callback_url: "http://zhixu-api-sg.zhixu.bigo.inner/justice-video-prod/machine-result-v2"
        rollback_offset: 128
      }
    }
  },
  {
    name: "TimestampFilterModule"
    conf: {
      instance_name: "TimestampFilterModule"
      work_thread_num: 1
      queue_size: 1
      enabled: true
      timestamp_filter: {
        expire_ms: 600000
      }
    } 
  },
  {
    name: "DuplicatedModule"
    conf: {
      instance_name: "DuplicateQueryModule"
      work_thread_num: 64
      queue_size: 1
      enabled: false
      duplicated: {
        timeout_ms: 2000
        password_index: 0
        hosts: "list://10.146.38.51:30171,10.148.35.77:30171,10.150.34.242:30171"
        prefix: "tiki"
        op: "query"
      }
    } 
  },
  {
    name: "DownloaderModule"
    conf: {
      work_thread_num: 64
      queue_size: 32
      enabled: true
      downloader: {
        timeout_ms: 30000
        max_retry: 3
        lb: "la"
        enable_image: true
        enable_video: true
        enable_voice: false
      }
    }
  },
  {
    name: "DecodeClusterDownloaderModule"
    conf: {
      work_thread_num: 64
      queue_size: 32
      enabled: true
      downloader: {
        timeout_ms: 30000
        max_retry: 1
        lb: "la"
      }
    }
  },
  {
    name: "DispatcherModule"
    conf: {
      work_thread_num: 64
      queue_size: 32
      enabled: true
      dispatcher: {
        batch_size: 1
        submodule_conf : [
          #-------------------------------- Cover Module
          {
            name: "LikeCoverSubModule"
            conf: {
              instance_name: "BlackScreenSubModule"
              rpc: {
                url: "http://blackscreen.like/api/blackscreen"
                lb: "la"
                max_retry: 1
                timeout_ms: 5000
              }
              thresholds:[
                {
                  model: "black_screen"
                  country: ["default"]
                  threshold:  -2268
                }
              ]
            }
          },
          {
            name: "LikeCoverSubModule"
            conf: {
              instance_name: "CoverSubModule"
              rpc: {
                url: "http://cover.like:80/api/cover"
                lb: "la"
                max_retry: 1
                timeout_ms: 5000
              }
              thresholds:[
                {
                  model: "cover_Comp"
                  country: ["default"]
                  threshold: 0.902615
                }
              ]
            }
          },

          #------------------------------- LikeTagSubModule
          {
            name: "LikeTagSubModule"
            conf: {
              instance_name: "DiscomfortSubModule"
              rpc: {
                url: "http://cv-horror-accident-flask-deploy.like:80/api/cv-horror-accident-flask-deploy"
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }
              effect_list: [
                {
                  effect_name: "cut_me_id"
                  model_name: "horror"
                  ids: [188, 368, 369, 1224],
                },
                {
                  effect_name: "cutme_id"
                  model_name: "horror"
                  ids: [459]
                },
                {
                  effect_name: "boom"
                  model_name: "horror"
                  ids: [19, 16, 14, 22, 12, 13, 17],
                },
                {
                  effect_name: "sticker"
                  model_name: "horror"
                  ids: [1463, 3164],
                },
                {
                  effect_name: "magic"
                  model_name: "horror"
                  ids: [1028]
                },
                {
                  effect_name: "sticker"
                  model_name: "accident"
                  ids: [1419, 1237, 98, 1432, 1243, 1158, 1524, 1414, 1404],
                },
                {
                  effect_name: "cutme_id"
                  model_name: "accident"
                  ids: [959]
                },
                {
                  effect_name: "magic"
                  model_name: "accident"
                  ids: [1004]
                },
                {
                  effect_name: "body_magic"
                  model_name: "accident"
                  ids: [38]
                }
              ] 
            }
          },
          {
            name: "LikeTagSubModule"
            conf: {
              instance_name: "SoftpornMultiSubModule"
              rpc: {
                url: "http://cv-softporn-global-flask-deploy.like:80/api/cv-softporn-global-flask-deploy"
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }

            }
          }, 
          {
            name: "LikeTagSubModule"
            conf: {
              instance_name: "DrugSubModule"
              rpc: {
                url: "http://cv-drug-cascade-flask-deploy.like:80/api/cv-drug-cascade-flask-deploy"
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }

            }
          }, 
          {
            name: "LikeTagSubModule"
            conf: {
              instance_name: "PoliticsSubModule"
              rpc: {
                url: "http://cv-politics-flask-deploy.like:80/api/cv-politics-flask-deploy"
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }
              effect_list: [
                {
                  effect_name: "magic"
                  model_name: "politics"
                  ids: [1043]
                }
              ]
            }
          }, 
          {
            name: "LikeTagSubModule"
            conf: {
              instance_name: "GambleSubModule"
              rpc: {
                url: "http://cv-gamble-flask-deploy.like:80/api/cv-gamble-flask-deploy"
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }

            }
          }, 
          {
            name: "LikeTagSubModule"
            conf: {
              instance_name: "SuicideSubModule"
              rpc: {
                url: "http://cv-suicide-funeral-flask-deploy.like:80/api/cv-suicide-funeral-flask-deploy"
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }

            }
          }, 

          #-------------------------------- FineGrainedSubModule 
          {
            name: "FineGrainedSubModule"
            conf: {
              instance_name: "KnifeSubModule"
              rpc: {
                url: "http://cv-knife-flask-deploy.like:80/api/cv-knife-flask-deploy"
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }
              enable_model: ["knife"]
            }
          }, 
          {
            name: "FineGrainedSubModule"
            conf: {
              instance_name: "PornActionSubModule"
              rpc: {
                url: "http://cv-action-porn-flask-deploy.like:80/api/cv-action-porn-flask-deploy"
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }
              enable_model: ["porn_action"]
            }
          },
          {
            name: "FineGrainedSubModule"
            conf: {
              instance_name: "GunSubModule"
              rpc: {
                url: "http://cv-gun-scene-duet-flask-deploy.like:80/api/cv-gun-scene-duet-flask-deploy"
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }

              enable_model: ["gun"]
            }
          },
          {
            name: "FineGrainedSubModule"
            conf: {
              instance_name: "SoftPornGlobalSubModule"
              rpc: {
                url: "http://softporn-global.like:80/api/softporn-global"
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }

              enable_model: ["softporn_global"]
            }
          },  

          {
            name: "FineGrainedSubModule"
            conf: {
              instance_name: "StaticPornSubModule"
              rpc: {
                url: "http://static-porn.like:80/api/static-porn"
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }

              enable_model: ["static_porn"]
            }
          },  

          {
            name: "FineGrainedSubModule"
            conf: {
              instance_name: "ViolenceActionSubModule"
              rpc: {
                url: "http://violence-action.like:80/api/violence-action"
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }
              effect_list: [
                {
                  effect_name: "sticker"
                  ids: [1419, 1432, 1243]
                }
              ]
              enable_model: ["violence_action"]
            }
          },  
         
          {
            name: "FineGrainedSubModule"
            conf: {
              instance_name: "ChildPornSubModule"
              rpc: {
                url: "http://child-porn.like:80/api/child-porn"
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }
              enable_model: ["child_porn"]
            }
          },  
          {
            name: "FineGrainedSubModule"
            conf: {
              instance_name: "HeavePornSubModule"
              rpc: {
                url: "http://heavy-porn.like:80/api/heavy-porn"
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }

              enable_model: ["heavy_porn"]
            }
          },  
          {
            name: "FineGrainedSubModule"
            conf: {
              instance_name: "KissSubModule"
              rpc: {
                url: "http://kiss.like:80/api/kiss"
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }
              enable_model: ["kiss"]
            }
          },  


          {
            name: "FineGrainedSubModule"
            conf: {
              instance_name: "CigaretteSubModule"
              rpc: {
                url: "http://cigarette.like:80/api/cigarette"
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }

              enable_model: ["cigarette"]
            }
          }, 

          {
            name: "FineGrainedSubModule"
            conf: {
              instance_name: "BloodSubModule"
              rpc: {
                url: "http://cv-blood-new-flask-deploy.like:80/api/cv-blood-new-flask-deploy"
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }

              enable_model: ["blood"]
              effect_list: [
                {
                  effect_name: "sticker"
                  ids: [1419, 27, 98, 1432, 1243, 2263, 13, 1414, 2188, 1404]
                }
              ]
            }
          }, 

          {
            name: "FineGrainedSubModule"
            conf: {
              instance_name: "TerrorFlagSubModule"
              rpc: {
                url: "http://cv-terror-flag-flask-deploy.like:80/api/cv-terror-flag-flask-deploy"
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }
              enable_model: ["terror_flag"]
              effect_list: [
                {
                  effect_name: "cut_me_id"
                  ids: [1571, 1572],
                },
                {
                  effect_name: "cutme_id"
                  ids: [1199]
                }
              ]
            }
          }, 

          

          {
            name: "LikeOcrSubModule"
            conf: {
              rpc: {
                url: "http://infer-hk.ingress.bigoml.cc:8080/api/like/likeocr"
                lb: "la"
                max_retry: 0
                timeout_ms: 10000
              }
              image_ocr: {
                rpc: {
                  url: "http://infer-sg.ingress.bigoml.cc:8080/api/like/word-audit"
                  lb: "rr"
                  timeout_ms: 3000
                  max_retry: 1
                }
              }
            } 
          },
          {
            name: "LikePornSubModule"
            conf: {
              rpc: {
                url: "http://like-core-porn-softporn.like:80/api/like-core-porn-softporn"
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }
              thresholds: [
                {
                  country: ["default"]
                  model: "porn"
                  threshold: 0.723
                },
                {
                  country: ["AE", "BH", "KW", "OM", "QA", "SA"]
                  model: "porn"
                  threshold: 0.31
                },
                {
                  country: ["BR", "PT", "RU", "UA", "BY", "KZ", "TJ", "KG", "UZ", "TM", "AM", "GE", "AZ", "LV", "LT", "EE", "DE", "AT", "LI", "BE", "CH", "IS", "NL", "CZ", "SK", "PL", "RO", "HR", "GR", "NO", "FI", "DK", "SE", "HU", "LU", "BA", "BG", "RS", "MK", "AL", "ME", "SI", "MD", "FR", "MC", "HT", "IT", "SM", "VA", "GB", "NZ", "AU", "IE", "PR", "MT"]
                  model: "porn"
                  threshold: 0.6
                },
                {
                  country: ["IN"]
                  model: "softporn"
                  threshold: 0.937
                }
              ]
            } 
          },

          # --------------------- Feature Module
          {
            name: "LikeWatermarkSubModule"
            conf: {
              rpc: {
                url: "http://like-watermark-audit.ann/api/like-watermark-audit"
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }
            } 
          },
          {
            name: "LikeGeneralFeatureModule"
            conf: {
              rpc: {
                url: "http://vbr-cnn-general-service.ann/api/vbr-cnn-general-service"
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }
              extra_data: [
                {
                  key: "ann_url" # disable ann service.
                  val: ""
                },
                {
                  key: "kakashi_url"
                  val: "http://infer-sg.ingress.bigoml.cc:8080/api/ann/tiki-kakashi"
                },
                {
                  key: "lowq_url"
                  val: "http://vbr-likee-low-quality-service.ann/api/vbr-likee-low-quality-service"
                },
                {
                  key: "ann_blacklist_url"
                  val: ""
                }
              ]
            } 
          },
          {
            name: "LikeLowQualityGeneralSubModule"
            conf: {
              # enable_model: ["child_alone"]
              rpc: {
                url: ""
                lb: "la"
                max_retry: 1
                timeout_ms: 10000
              }
            } 
          }
        ]
      }
    }
  },
  {
    name: "LikeReviewModule"
    conf: {
      enabled: true
      work_thread_num: 128
      review: {
        timeout_ms: 2000
        lb: "la"
        max_retry: 3
        appid: "9501"
      }
    }
  },
  {
    name: "UploadHiveModule"
    conf: {
      enabled: true
      work_thread_num: 128
      upload_hive: {
        timeout_ms: 1500
        lb: "rr"
        max_retry: 1
        url: "http://support_json.like.video/json?uri=123213425&aid=60"
        rewrite_business_type: "tiki_video_push"
      }
    }
  },
  {
    name: "DuplicatedModule"
    conf: {
      instance_name: "DuplicateWriteModule"
      work_thread_num: 64
      queue_size: 1
      enabled: true
      duplicated: {
        timeout_ms: 2000
        password_index: 0
        hosts: "list://10.146.38.51:30171,10.148.35.77:30171,10.150.34.242:30171"
        prefix: "tiki"
        expire_second: 604800 # 7 Day
        op: "write"
      }
    } 
  },
  {
    name: "EndModule"
    conf: {
      enabled: true
      work_thread_num: 12
    }
  }
]