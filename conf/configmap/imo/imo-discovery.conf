module_conf: [
  {
    name: "KafkaConsumerModule"
    conf: {
      work_thread_num: 1
      enabled: true
      queue_size: 256
      kafka_consumer: {
        brokers: "kafka-rec52.jja.bigo-out:9092,kafka-rec53.jja.bigo-out:9092,kafka-rec54.jja.bigo-out:9092,kafka-rec55.jja.bigo-out:9092,kafka-rec56.jja.bigo-out:9092"
        groupid: ["ml_imo_discover_audit"]
        topic: ["ml_imo_discover_audit"]
        rollback_offset: 1024 
      }
    }
  },
  {
    name: "DuplicatedModule"
    conf: {
      instance_name: "DuplicateQueryModule"
      work_thread_num: 64
      queue_size: 32
      enabled: true
      duplicated: {
        timeout_ms: 2000
        password_index: 0
        hosts: "list://10.146.38.51:30171,10.148.35.77:30171,10.150.34.242:30171"
        prefix: "imo_discover_"
        expire_second: 604800 # 7 Day
        op: "query"
      }
    } 
  },
  {
    name: "DownloaderModule"
    conf: {
      work_thread_num: 64
      queue_size: 256
      enabled: true
      downloader: {
        timeout_ms: 25000
        max_retry: 1
        lb: "rr"
        enable_image: true
        enable_video: true
        enable_voice: false
      }
    }
  }, 
  {
    name: "ImageDispatcherModule"
    conf: {
      work_thread_num: 128
      enabled: true
      dispatcher: {
        batch_size: 1
        block_queue_timeout_ms: 2000
        submodule_conf : [
          {
            name: "MultiImageSubModule"
            conf: {
              instance_name: "MultiImageSubModule"
              rpc: {
                url: "http://imo-discovery-pic.imo/api/imo-discovery-pic"
                lb: "rr"
                max_retry: 2
                timeout_ms: 5000
              }
              enable_model: ["imo_pic_Comp", "normal"] 
              thresholds: [
                {
                  country: ["default"]
                  model: "imo_pic_Comp"
                  threshold: 0.2323
                },
                {
                  country: ["default"]
                  model: "normal"
                  threshold: 10
                }
              ]
            },
          },
          {
            name: "ImoDiscoverSubModule"
            conf: {
              instance_name: "ImoDiscoverImageSubModule"
              rpc: {
                url: "http://infer-hk.ingress.bigoml.cc:8080/api/vbr-imo-discover"
                lb: "rr"
                max_retry: 2
                timeout_ms: 90000
              }
              extra_data: [
                {
                  key: "result_key"
                  val: "vbr-imo-discover"
                }
              ]
            } 
          },
          {
            name: "LabelControlSubModule"
            conf: {
              instance_name: "SoftPornLabelControlSubModule"
              rpc: {
                url: "http://cv-porn-softporn-multilabel-image-service.common:8000/api/cv-porn-softporn-multilabel-image-service"
                lb: "rr"
                max_retry: 1
                timeout_ms: 3000
              }
              basic: {
                class_num: 5
                model_types: "resnet50ml"
                model_keys: "heavy_porn,sex_toy,sexual_cues,kiss,focus"
                appid: "pic-softporn-cls3"
                normal_label_index: -1
              }
              label_control_conf: {
                mapping_conf: {
                  mapping_indices: [0, 1, 2, 3, 4]
                  aggragation_types: ["default", "default", "default", "default", "default"]
                }
                mapped_conf: {
                  mapped_class_num: 5
                  mapped_model_keys: "heavy_porn,sex_toy,sexual_cues,kiss,focus"
                }
                selected_indices: [2, 3, 4]
              }
              thresholds: [
                {
                  country: ["default"]
                  model: "sexual_cues"
                  threshold: 0.3510787079615619
                },
                {
                  country: ["default"]
                  model: "kiss"
                  threshold: 0.9999576653316332
                },
                {
                  country: ["default"]
                  model: "focus"
                  threshold: 0.00035538355309835333
                }
              ]
            }
          },
          {
            name: "ImageWatermarkImoSubModule"
            conf: {
              rpc: {
                url: "http://imo-watermark-img-audit.ann:8000/api/imo-watermark-img-audit"
                lb: "rr"
                max_retry: 1
                timeout_ms: 5000
              },
              enable_model: ["watermark"] 
            }
          },
          {
            name: "ImoFakevideoSubModule"
            conf: {
              rpc: {
                url: "http://imo-discovery-fakevideo.ann:80/api/imo-discovery-fakevideo/det"
                lb: "rr"
                max_retry: 1
                timeout_ms: 5000
              },
              enable_model: ["fakevideo"] 
            }
          }
        ]
      }
    }
  },
  {
    name: "VideoDispatcherModule"
    conf: {
      work_thread_num: 32
      enabled: true
      dispatcher: {
        batch_size: 1
        block_queue_timeout_ms: 2000
        submodule_conf : [
          {
            name: "VideoNormalizationSubModule"
            conf: {
              instance_name: "VideoNormalizationSubModule"
              rpc: {
                url: "http://imo-discovery-video-core.imo/api/imo-discovery-video-core"
                lb: "rr"
                max_retry: 2
                timeout_ms: 90000
              }
              enable_model: ["violence_blood", "porn"] 
              thresholds: [
                {
                  country: ["default"]
                  model: "violence_blood"
                  threshold: 0.957043
                },
                {
                  country: ["default"]
                  model: "porn"
                  threshold: 0.799371
                }
              ]
            }
          },
          {
            name: "ImoDiscoverSubModule"
            conf: {
              instance_name: "ImoDiscoverVideoSubModule"
              rpc: {
                url: "http://infer-hk.ingress.bigoml.cc:8080/api/vbr-imo-discover"
                lb: "rr"
                max_retry: 2
                timeout_ms: 90000
              }
              extra_data: [
                {
                  key: "result_key"
                  val: "vbr-imo-discover"
                }
              ]
            } 
          },
          {
            name: "VideoWatermarkImoSubModule"
            conf: {
              rpc: {
                url: "http://imo-watermark-video-audit.ann:8000/api/imo-watermark-video-audit"
                lb: "rr"
                max_retry: 1
                timeout_ms: 90000
              },
              enable_model: ["watermark"] 
            }
          }
        ]
      }
    }
  },
  {
    name: "ModifyFailResModule"
    conf: {
      work_thread_num: 2
      enabled: true
      modify_fail_res: {
        ignore_models: ["group_chat_vega"]
      }
    }
  },
  {
    name: "ReviewModule"
    conf: {
      enabled: true
      work_thread_num: 128
      review: {
        timeout_ms: 2000
        lb: "rr"
        max_retry: 3
      }
    }
  },
  {
    name: "UploadHiveModule"
    conf: {
      enabled: true
      work_thread_num: 128
      upload_hive: {
        timeout_ms: 1500
        lb: "rr"
        max_retry: 1
        url: "http://support_json.like.video/json?uri=123213423&aid=60"

      }
    }
  },
  {
    name: "DuplicatedModule"
    conf: {
      instance_name: "DuplicateWriteModule"
      work_thread_num: 64
      queue_size: 32
      enabled: true
      duplicated: {
        timeout_ms: 2000
        password_index: 0
        hosts: "list://10.146.38.51:30171,10.148.35.77:30171,10.150.34.242:30171"
        prefix: "imo_discover_"
        expire_second: 604800 # 7 Day
        op: "write"
      }
    } 
  },
  {
    name: "EndModule"
    conf: {
      enabled: true
      work_thread_num: 1
    }
  }
]
